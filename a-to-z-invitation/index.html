<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>Majlis Kesyukuran Perkahwinan Zuhaira & Aiman</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="description" content="Dengan penuh kesyukuran, kami menjemput anda ke majlis perkahwinan kami pada 14 Februari 2026.">
  
  <link rel="icon" href="img/logo1.ico" type="image/x-icon">
  
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Wedding Invitation">
  <meta property="og:title" content="Majlis Perkahwinan Zuhaira & Aiman">
  <meta property="og:description" content="Sabtu, 14 Februari 2026 | 12:00 PM | Kampung Bendang Pak Yong, Tumpat, Kelantan">
  <meta property="og:url" content="https://a-to-z-lovat.vercel.app/">
  <meta property="og:image" content="https://a-to-z-lovat.vercel.app/img/og-preview.jpg">
  <meta property="og:image:secure_url" content="https://a-to-z-lovat.vercel.app/img/og-preview.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Jemputan Majlis Perkahwinan Zuhaira & Aiman">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Majlis Perkahwinan Zuhaira & Aiman">
  <meta name="twitter:description" content="Sabtu, 14 Februari 2026 | 12:00 PM">
  <meta name="twitter:image" content="https://a-to-z-lovat.vercel.app/img/og-preview.jpg">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Quicksand:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
</head>
  
<body>
  <!-- Landing Page Overlay -->
  <div class="landing-overlay" id="landingOverlay" >
    <div class="landing-decoration top-left"></div>
    <div class="landing-decoration bottom-right"></div>
    
    <div class="landing-content">
      <!-- <div class="landing-subtitle">Majlis Kesyukuran Perkahwinan</div> -->
      <!-- <div class="landing-decorative-line"></div> -->
      <div class="landing-title">
        <img src="img/logosimple.png" alt="Simple logo" class="simple-logo">
      </div>
      <div class="landing-decorative-line"></div>
      <div class="landing-names">Zuhaira <span class="landing-ampersand">&</span> Aiman
      </div>
      <div class="landing-date-container">
        <div>
        <div class="divider"></div>
        <div class="landing-date-day">Sabtu</div>
        <div class="divider"></div>
        </div>
        <div>
          <div class="landing-date-month">Feb</div>
          <div class="landing-date-number">14</div>
          <div class="landing-date-year">2026</div>
        </div>
        <div>
          <div class="divider"></div>
          <div class="landing-date-time">12pm</div>
          <div class="divider"></div>
        </div>
      </div>
      
      <div class="landing-click-hint" onclick="openInvitation(event)">
        <!-- <i class="fas fa-hand-pointer"></i> Ketik untuk membuka jemputan  -->
         <img src="img/fingerprint.png" alt="Fingerprint logo" class="fingerprint-logo">
        <!-- TODO: LETAK LOGO FINGER PRINT -->
      </div>
    </div>
  </div>

  <!-- Main Content (Your existing content) -->
  <div class="main-content" id="mainContent">
    <!-- Main Invitation Section -->
    <div class="section">
      <div class="container">
        <div class="three-column">
          
          <!-- Text Column -->
          <div class="text-column">
            <p class="invitation-line events-title">Majlis Kesyukuran Perkahwinan</p>
            <p class="invitation-line bismillah">بِسْمِ ٱللّٰهِ ٱلرَّحْمَـٰنِ ٱلرَّحِيمِ</p>
            <p class="invitation-line body-text">Dengan nama Allah Yang Maha Pemurah Lagi Maha Penyayang</p>
            <p class="invitation-line body-text">Dengan penuh rendah hati serta kesyukuran ke hadrat Ilahi, kami,</p>
            <p class="invitation-line body-text"><strong>ZAKARIA BIN CHE DOLLAH</strong><br>&<br><strong>MAZNI BINTI SHAFII</strong></p>
            <p class="invitation-line body-text">menyusun sepuluh jari menjemput Tuan, Puan, Encik</p>
            <p class="invitation-line body-text">dan Cik, ke majlis kesyukuran perkahwinan anakanda kami,</p>
            <p class="invitation-line couple-names">
              Zuhaira Nasrin Binti Zakaria
              <br>&<br>
              Muhammad Aiman Haikal Bin Hairol Anuar
            </p>
            <p class="invitation-line body-text"><strong>Sabtu, 14 Februari 2026</strong><br>bersamaan <strong>25 Sha'ban 1447 H</strong></p>
            <p class="invitation-line body-text">di <strong>Lot. 1063 Kampung Bendang Pak Yong,<br>16200 Tumpat, Kelantan</strong></p>
            <p class="invitation-line body-text">Semoga dengan kehadiran Tuan/Puan/Encik/Cik menjadi</p>
            <p class="invitation-line body-text">penyeri majlis dan membawa berkat sepanjang hayat mereka.</p>
          </div>

          <!-- Info Column with Scroll Reveal Classes -->
          <div class="info-column">
            <!-- Event Schedule - Each part gets its own reveal -->
            <p class="invitation-line events-title">Aturcara Majlis</p>

            <div class="invitation-line event-schedule">
              <div class="event-item">
                <span class="event-time">12:00 PM</span>
                <span class="event-desc">Ketibaan Pengantin</span>
              </div>

              <div class="event-item">
                <span class="event-time">1:00 - 4:00 PM</span>
                <span class="event-desc">Jamuan Makan/Sesi Santai</span>
              </div>

              <div class="event-item">
                <span class="event-time">5:00 PM</span>
                <span class="event-desc">Majlis Bersurai</span>
              </div>
            </div>

            <!-- Countdown - Separate reveals for title and counter -->
            <div class="invitation-line countdown-container">
              <div class="countdown-decoration top-left"></div>
              <div class="countdown-decoration bottom-right"></div>
              <p class="invitation-line events-title">Menanti Hari Bahagia</p>
              <div class="countdown-units">
                <div class="countdown-unit">
                  <div class="countdown-value" id="countdown-days">265</div>
                  <div class="countdown-label">Hari</div>
                </div>
                <div class="countdown-unit">
                  <div class="countdown-value" id="countdown-hours">12</div>
                  <div class="countdown-label">Jam</div>
                </div>
                <div class="countdown-unit">
                  <div class="countdown-value" id="countdown-minutes">30</div>
                  <div class="countdown-label">Minit</div>
                </div>
                <div class="countdown-unit">
                  <div class="countdown-value" id="countdown-seconds">45</div>
                  <div class="countdown-label">Saat</div>
                </div>
              </div>
            </div>
          
            <div class="button-container">
              <a href="https://forms.gle/1hLaD3QR4mmGzbTJ8" target="_blank" class="btn btn-primary">
                <i class="fas fa-calendar-check"></i>
                Sahkan Kehadiran
              </a>
              <button onclick="openLocationModal()" class="btn btn-outline">
                  <i class="fas fa-map-marker-alt"></i>
                  Lihat Lokasi
              </button>
              <a href="info.html" target="_blank" class="btn btn-outline">
                <i class="fas fa-info-circle"></i>
                Info Lanjut
              </a>
            </div>

            <div id="locationModal" class="modal">
              <div class="modal-content">
                  <span class="close" onclick="closeLocationModal()">&times;</span>
                  <div class="modal-header">
                      <h3><i class="fas fa-map-marker-alt"></i> Pilih Aplikasi Peta</h3>
                      <p>Buka lokasi dengan aplikasi pilihan anda</p>
                  </div>
                  <div class="modal-buttons">
                      <a href="https://maps.app.goo.gl/H8Ay22CgTzp73WMi6" target="_blank" class="modal-btn btn-google" onclick="closeLocationModal()">
                          <i class="fab fa-google"></i>
                          Google Maps
                      </a>
                      <a href="https://waze.com/ul/hw30e559hb" target="_blank" class="modal-btn btn-waze" onclick="closeLocationModal()">
                          <i class="fab fa-waze"></i>
                          Waze
                      </a>
                      <button onclick="closeLocationModal()" class="modal-btn btn-cancel">
                          <i class="fas fa-times"></i>
                          Batal
                      </button>
                  </div>
              </div>
          </div>
        </div>

          
        <!-- Image Column -->
          <div class="image-column">
            <p class="invitation-line events-title">Galeri</p>
            <div class="slideshow-container" id="slideshowContainer">
              <div class="slide active">
                <img src="img/bride_detail.jpeg" alt="Couple Photo 1">
              </div>
              <div class="slide">
                <img src="img/bride_only.jpeg" alt="Couple Photo 2">
              </div>
              <div class="slide">
                <img src="img/formal_both.jpeg" alt="Couple Photo 3">
              </div>
              <div class="slide">
                <img src="img/fun_both.jpeg" alt="Couple Photo 4">
              </div>
              <div class="slide">
                <img src="img/natural_both.jpeg" alt="Couple Photo 5">
              </div>

              <button class="slide-nav prev" onclick="changeSlide(-1)">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="slide-nav next" onclick="changeSlide(1)">
                <i class="fas fa-chevron-right"></i>
              </button>
              
              <a href="https://www.facebook.com/rahmatphotozaidani" target="_blank" class="photo-credit">
                <i class="fab fa-facebook"></i> rahmatphotozaidani
              </a>
              
              <div class="slide-indicators">
                <span class="slide-dot active" onclick="currentSlide(0)"></span>
                <span class="slide-dot" onclick="currentSlide(1)"></span>
                <span class="slide-dot" onclick="currentSlide(2)"></span>
                <span class="slide-dot" onclick="currentSlide(3)"></span>
                <span class="slide-dot" onclick="currentSlide(4)"></span>
              </div>
            </div>
            <div class="invitation-line hashtag" contenteditable>#fromAtoZ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Wishes Section -->
    <section class="invitation-line wishes-section" id="wishes-section">
      <div class="container">
        <div class="wishes-header">
          <h2 class="wishes-title">Ucapan & Doa</h2>
          <button class="refresh-btn">
            <i class="fas fa-sync-alt"></i> Muat Semula Ucapan
          </button>
        </div>

        <div id="wishes-loading" class="wishes-loading">
          <div class="loading-spinner"></div>
          <span>Sedang memuatkan ucapan...</span>
        </div>

        <div id="wishes-error" class="wishes-error hidden"></div>
        <div id="wishes-stats" class="wishes-stats hidden"></div>
        <div id="wishes-grid" class="wishes-grid"></div>
      </div>
    </section>

    <!-- Floating Action Button -->
    <button class="floating-btn" onclick="toggleScroll()" id="scrollToggleBtn">
      <i class="fa fa-chevron-down"></i>
    </button>

    <!-- Decorative Elements -->
    <img src="img/filler2.png" class="corner-decoration bottom-left" alt="Flower Decoration">
    <img src="img/filler1.png" class="corner-decoration top-right" alt="Flower Decoration">

    <div class="sticky-bottom-band">
      <div class="band-content">
          <a href="https://forms.gle/1hLaD3QR4mmGzbTJ8" target="_blank" class="btn btn-band">
              <i class="fas fa-calendar-check"></i>
          </a>
      </div>
      <div class="band-content">
          <button onclick="openLocationModal()" class="btn btn-band">
              <i class="fas fa-map-marker-alt"></i>
      </div>
      <div class="band-content">
          <a href="info.html" target="_blank" class="btn btn-band">
              <i class="fas fa-info-circle"></i>
          </a>
      </div>
      <div class="band-content">
          <a href="gifts.html" target="_blank" class="btn btn-band">
              <i class="fas fa-gift"></i>
          </a>
      </div>
    </div>
  </div>
  
  <script>

    const WEDDING_CONFIG = {
  // Wedding Details
  weddingDate: "Feb 14, 2026 12:01:00",
  
  location: {
    googleMapsUrl: "https://maps.app.goo.gl/H8Ay22CgTzp73WMi6",
    wazeUrl: "https://waze.com/ul/hw30e559hb",
    modalText: {
      title: "Pilih Aplikasi Peta",
      subtitle: "Buka lokasi dengan aplikasi pilihan anda",
      googleMaps: "Google Maps",
      waze: "Waze",
      cancel: "Batal"
    }
  },
  
  slideshow: {
    autoAdvanceDelay: 5000,
    enableAutoAdvance: true
  },
  
  animation: {
    mobileRevealDelay: 1200,
    mobileScrollDelay: 150,
    buttonShowDelay: 500,
    scrollTrigger: {
      threshold: 0.2,
      rootMargin: '0px 0px -10% 0px',
      fadeDistance: 30,
      animationDuration: 800,
      animationEasing: 'cubic-bezier(0.4, 0, 0.2, 1)'
    }
  },
  
  breakpoint: {
    mobile: 768
  },
  
  wishes: {
    sheetId: '1pGniIsCYrVZZav3XIEdD51XO-CSGsyWp7ESrLPA0UdE',
    useCsvMethod: true,
    range: 'Sheet1!A:F',
    nameColumn: 2,
    wishColumn: 5,
    refreshInterval: 5 * 60 * 1000,
    loadingMessages: {
      loading: 'Memuatkan ucapan...',
      error: 'Gagal memuatkan ucapan. Sila semak sambungan internet anda dan cuba lagi.',
      noWishes: 'Tiada ucapan dijumpai dalam spreadsheet.',
      noValidWishes: 'Tiada ucapan yang sah dijumpai. Sila pastikan lajur nama dan ucapan mengandungi data.',
      statsTemplate: 'Jumlah ucapan: <strong>{count}</strong>'
    }
  },
  
  ui: {
    scrollButton: {
      viewWishes: "Lihat Ucapan",
      backToTop: "Kembali ke Atas"
    }
  }
};
    // 2. ADD THE ENTIRE CLASS HERE
class WeddingInvitation {
  constructor(config = WEDDING_CONFIG) {
    this.config = config;
    this.state = {
      currentIndex: 0,
      slideIndex: 0,
      slideTimer: null,
      isMobile: window.innerWidth <= config.breakpoint.mobile,
      countdownTimer: null
    };
    
    this.elements = this.initializeElements();
    this.init();
  }

  initializeElements() {
    return {
      lines: document.querySelectorAll('.invitation-line'),
      slideshowContainer: document.getElementById('slideshowContainer'),
      buttonContainer: document.querySelector('.button-container'),
      backBtn: document.getElementById('backBtn'),
      scrollToggleBtn: document.getElementById('scrollToggleBtn'),
      wishesSection: document.getElementById('wishes-section'),
      locationModal: document.getElementById('locationModal'),
      countdown: {
        days: document.getElementById("countdown-days"),
        hours: document.getElementById("countdown-hours"),
        minutes: document.getElementById("countdown-minutes"),
        seconds: document.getElementById("countdown-seconds")
      },
      wishes: {
        loading: document.getElementById('wishes-loading'),
        error: document.getElementById('wishes-error'),
        stats: document.getElementById('wishes-stats'),
        grid: document.getElementById('wishes-grid')
      }
    };
  }

  init() {
    this.setupScrollReveal();
    this.initializeSlideshow();
    this.initializeCountdown();
    this.initializeWishes();
    this.setupScrollToggle();
    this.setupBackButton();
    this.setupWishesRefreshButton();
    this.setupLocationModal();
  }

  // =============================================================================
    // LOCATION MODAL MODULE
    // =============================================================================

    setupLocationModal() {
      // Make location modal functions globally accessible for HTML onclick handlers
      window.openLocationModal = () => this.openLocationModal();
      window.closeLocationModal = () => this.closeLocationModal();
      
      // Close modal when clicking outside of it
      window.addEventListener('click', (event) => {
        if (this.elements.locationModal && event.target === this.elements.locationModal) {
          this.closeLocationModal();
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          this.closeLocationModal();
        }
      });
      
      // Update modal content with config text
      this.updateLocationModalContent();
    }

    openLocationModal() {
      if (this.elements.locationModal) {
        this.elements.locationModal.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
      }
    }

    closeLocationModal() {
      if (this.elements.locationModal) {
        this.elements.locationModal.classList.remove('show');
        document.body.style.overflow = 'auto'; // Restore scrolling
      }
    }

    updateLocationModalContent() {
      if (!this.elements.locationModal) return;
      
      const modalTitle = this.elements.locationModal.querySelector('.modal-header h3');
      const modalSubtitle = this.elements.locationModal.querySelector('.modal-header p');
      const googleBtn = this.elements.locationModal.querySelector('.btn-google');
      const wazeBtn = this.elements.locationModal.querySelector('.btn-waze');
      const cancelBtn = this.elements.locationModal.querySelector('.btn-cancel');
      
      if (modalTitle) {
        modalTitle.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${this.config.location.modalText.title}`;
      }
      if (modalSubtitle) {
        modalSubtitle.textContent = this.config.location.modalText.subtitle;
      }
      if (googleBtn) {
        googleBtn.href = this.config.location.googleMapsUrl;
        googleBtn.innerHTML = `<i class="fab fa-google"></i> ${this.config.location.modalText.googleMaps}`;
      }
      if (wazeBtn) {
        wazeBtn.href = this.config.location.wazeUrl;
        wazeBtn.innerHTML = `<i class="fab fa-waze"></i> ${this.config.location.modalText.waze}`;
      }
      if (cancelBtn) {
        cancelBtn.innerHTML = `<i class="fas fa-times"></i> ${this.config.location.modalText.cancel}`;
      }
    }

    // =============================================================================
    // SCROLL REVEAL MODULE
    // =============================================================================

    setupScrollReveal() {
      if (this.state.isMobile) {
        this.setupMobileScrollTrigger(); 
      } else {
        this.setupDesktopManualReveal();
      }
    }

    setupMobileScrollTrigger() {
      this.initializeScrollObserver();
      this.addScrollTriggerStyles();
    }

    initializeScrollObserver() {
  // Create intersection observer options
  const observerOptions = {
    root: null, // Use viewport as root
    rootMargin: this.config.animation.scrollTrigger.rootMargin,
    threshold: this.config.animation.scrollTrigger.threshold
  };

  // Create the intersection observer
  this.scrollObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // Element is entering the viewport - fade in with slide up
        this.animateElementIn(entry.target);
      } else {
        // Element is leaving the viewport - fade out
        this.animateElementOut(entry.target);
      }
    });
  }, observerOptions);

  // Observe all invitation lines
  this.elements.lines.forEach((line, index) => {
    // Reset line visibility for scroll-triggered animation
    line.classList.remove('visible');
    line.classList.add('scroll-trigger-element');
    
    // Add initial transform for fade-up animation
    line.style.transform = `translateY(${this.config.animation.scrollTrigger.fadeDistance}px)`;
    line.style.opacity = '0';
    line.style.transition = `all ${this.config.animation.scrollTrigger.animationDuration}ms ${this.config.animation.scrollTrigger.animationEasing}`;
    
    // Start observing this element
    this.scrollObserver.observe(line);
  });

  // Also observe slideshow container
  if (this.elements.slideshowContainer) {
    this.elements.slideshowContainer.classList.add('scroll-trigger-element');
    this.elements.slideshowContainer.style.transform = `translateY(${this.config.animation.scrollTrigger.fadeDistance}px)`;
    this.elements.slideshowContainer.style.opacity = '0';
    this.elements.slideshowContainer.style.transition = `all ${this.config.animation.scrollTrigger.animationDuration}ms ${this.config.animation.scrollTrigger.animationEasing}`;
    this.scrollObserver.observe(this.elements.slideshowContainer);
  }

  // Observe button container
  if (this.elements.buttonContainer) {
    this.elements.buttonContainer.classList.add('scroll-trigger-element');
    this.elements.buttonContainer.style.transform = `translateY(${this.config.animation.scrollTrigger.fadeDistance}px)`;
    this.elements.buttonContainer.style.opacity = '0';
    this.elements.buttonContainer.style.transition = `all ${this.config.animation.scrollTrigger.animationDuration}ms ${this.config.animation.scrollTrigger.animationEasing}`;
    this.scrollObserver.observe(this.elements.buttonContainer);
  }
}

// Animate element into view
animateElementIn(element) {
  element.classList.add('visible', 'scroll-triggered');
  element.style.transform = 'translateY(0)';
  element.style.opacity = '1';
  
  // Add a subtle delay based on element index for staggered effect
  const elementIndex = Array.from(this.elements.lines).indexOf(element);
  if (elementIndex !== -1) {
    element.style.transitionDelay = `${elementIndex * 50}ms`; // 50ms stagger
  }
}

// Animate element out of view
animateElementOut(element) {
  element.classList.remove('visible', 'scroll-triggered');
  element.style.transform = `translateY(${this.config.animation.scrollTrigger.fadeDistance}px)`;
  element.style.opacity = '0';
  element.style.transitionDelay = '0ms'; // Reset delay when fading out
}

// Add CSS styles for scroll-triggered elements
addScrollTriggerStyles() {
  // Check if styles are already added
  if (document.getElementById('scroll-trigger-styles')) return;
  
  const styleSheet = document.createElement('style');
  styleSheet.id = 'scroll-trigger-styles';
  styleSheet.textContent = `
    /* Scroll-triggered animation styles */
    .scroll-trigger-element {
      will-change: transform, opacity;
    }
    
    .scroll-trigger-element.scroll-triggered {
      transform: translateY(0) !important;
      opacity: 1 !important;
    }
    
    /* Enhanced mobile animations */
    @media (max-width: ${this.config.breakpoint.mobile}px) {
      .invitation-line {
        transform: translateY(30px);
        opacity: 0;
        transition: all 800ms cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .invitation-line.visible {
        transform: translateY(0);
        opacity: 1;
      }
      
      /* Smooth slideshow reveal */
      #slideshowContainer {
        transform: translateY(40px);
        opacity: 0;
        transition: all 1000ms cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      #slideshowContainer.visible {
        transform: translateY(0);
        opacity: 1;
      }
      
      /* Button container fade-in */
      .button-container {
        transform: translateY(20px);
        opacity: 0;
        transition: all 600ms cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .button-container.visible {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `;
  
  document.head.appendChild(styleSheet);
}

// Updated updateVisibility method to work with scroll-triggered animations
updateVisibility() {
  // For mobile, visibility is now handled by scroll observer
  if (this.state.isMobile) {
    // Don't manually update visibility - let scroll observer handle it
    return;
  }
  
  // Keep original desktop behavior
  this.elements.lines.forEach((line, index) => {
    line.classList.toggle('visible', index <= this.state.currentIndex);
  });

  // Show/hide slideshow and buttons for desktop
  if (this.state.currentIndex >= this.elements.lines.length) {
    this.elements.slideshowContainer.classList.add('visible');
    
    setTimeout(() => {
      if (this.elements.buttonContainer) {
        this.elements.buttonContainer.classList.add('visible');
      }
    }, this.config.animation.buttonShowDelay);
  } else {
    this.elements.slideshowContainer.classList.remove('visible');
    if (this.elements.buttonContainer) {
      this.elements.buttonContainer.classList.remove('visible');
    }
  }
}

// Cleanup method update to include scroll observer
destroy() {
  if (this.state.slideTimer) clearTimeout(this.state.slideTimer);
  if (this.state.countdownTimer) clearInterval(this.state.countdownTimer);
  
  // Clean up scroll observer
  if (this.scrollObserver) {
    this.scrollObserver.disconnect();
    this.scrollObserver = null;
  }
  
  // Remove added styles
  const styleSheet = document.getElementById('scroll-trigger-styles');
  if (styleSheet) {
    styleSheet.remove();
  }
}

// Optional: Method to manually trigger scroll check (useful for dynamic content)
triggerScrollCheck() {
  if (this.scrollObserver && this.state.isMobile) {
    // Re-observe all elements to trigger intersection check
    this.elements.lines.forEach(line => {
      this.scrollObserver.unobserve(line);
      this.scrollObserver.observe(line);
    });
  }
}

// Optional: Method to update scroll trigger settings
updateScrollTriggerSettings(newSettings) {
  if (!this.state.isMobile) return;
  
  // Update config
  this.config.animation.scrollTrigger = {
    ...this.config.animation.scrollTrigger,
    ...newSettings
  };
  
  // Reinitialize scroll observer with new settings
  if (this.scrollObserver) {
    this.scrollObserver.disconnect();
  }
  this.initializeScrollObserver();
}

    setupDesktopManualReveal() {
      this.startAutoReveal();

      // Click to advance
      window.addEventListener('click', (e) => {
        if (this.shouldIgnoreClick(e.target)) return;
        
        if (this.state.currentIndex < this.elements.lines.length) {
          this.state.currentIndex++;
          this.updateVisibility();
        }
      });
    }

    startAutoReveal() {
      const revealDelay = 700; // 1.5 seconds between each reveal
      
      const revealNext = () => {
        if (this.state.currentIndex < this.elements.lines.length) {
          this.state.currentIndex++;
          this.updateVisibility();
          setTimeout(revealNext, revealDelay);
        }
      };
      
      // Start the first reveal after a short delay
      setTimeout(revealNext, 300);
    }

    shouldIgnoreClick(target) {
      const ignoreClasses = ['prev', 'next', 'dot', 'info-button', 'map-button', 'back-button', 'modal', 'modal-content', 'modal-btn'];
      return ignoreClasses.some(className => target.classList.contains(className)) ||
            target.closest('.modal') !== null;
    }

    updateVisibility() {
      // Update line visibility
      this.elements.lines.forEach((line, index) => {
        line.classList.toggle('visible', index <= this.state.currentIndex);
      });

      // Show/hide slideshow and buttons
      if (this.state.currentIndex >= this.elements.lines.length) {
        this.elements.slideshowContainer.classList.add('visible');
        
        setTimeout(() => {
          if (this.elements.buttonContainer) {
            this.elements.buttonContainer.classList.add('visible');
          }
        }, this.config.animation.buttonShowDelay);
      } else {
        this.elements.slideshowContainer.classList.remove('visible');
        if (this.elements.buttonContainer) {
          this.elements.buttonContainer.classList.remove('visible');
        }
      }
    }

    // =============================================================================
    // SLIDESHOW MODULE
    // =============================================================================

    initializeSlideshow() {
      this.showSlides();
      if (this.config.slideshow.enableAutoAdvance) {
        this.startSlideTimer();
      }
      
      // Make slideshow methods globally accessible for HTML onclick handlers
      window.changeSlide = (n) => this.changeSlide(n);
      window.currentSlide = (n) => this.setCurrentSlide(n);
    }

    showSlides() {
      const slides = document.querySelectorAll('.slide');
      const dots = document.querySelectorAll('.dot');
      
      slides.forEach(slide => slide.classList.remove('active'));
      dots.forEach(dot => dot.classList.remove('active-dot'));
      
      if (slides.length > 0) {
        slides[this.state.slideIndex].classList.add('active');
        if (dots.length > 0) {
          dots[this.state.slideIndex].classList.add('active-dot');
        }
      }
    }

    changeSlide(n) {
      this.clearSlideTimer();
      const slides = document.querySelectorAll('.slide');
      this.state.slideIndex += n;
      
      if (this.state.slideIndex >= slides.length) {
        this.state.slideIndex = 0;
      } else if (this.state.slideIndex < 0) {
        this.state.slideIndex = slides.length - 1;
      }
      
      this.showSlides();
      if (this.config.slideshow.enableAutoAdvance) {
        this.startSlideTimer();
      }
    }

    setCurrentSlide(n) {
      this.clearSlideTimer();
      this.state.slideIndex = n;
      this.showSlides();
      if (this.config.slideshow.enableAutoAdvance) {
        this.startSlideTimer();
      }
    }

    startSlideTimer() {
      this.state.slideTimer = setTimeout(() => {
        this.changeSlide(1);
      }, this.config.slideshow.autoAdvanceDelay);
    }

    clearSlideTimer() {
      if (this.state.slideTimer) {
        clearTimeout(this.state.slideTimer);
        this.state.slideTimer = null;
      }
    }

    // =============================================================================
    // COUNTDOWN MODULE
    // =============================================================================

    initializeCountdown() {
      if (!this.elements.countdown.days) return;
      
      this.updateCountdown();
      this.state.countdownTimer = setInterval(() => {
        this.updateCountdown();
      }, 1000);
    }

    updateCountdown() {
      const weddingDate = new Date(this.config.weddingDate).getTime();
      const now = new Date().getTime();
      const distance = weddingDate - now;
      
      if (distance < 0) {
        this.setCountdownToZero();
        if (this.state.countdownTimer) {
          clearInterval(this.state.countdownTimer);
        }
        return;
      }
      
      const timeUnits = this.calculateTimeUnits(distance);
      this.updateCountdownDisplay(timeUnits);
    }

    calculateTimeUnits(distance) {
      return {
        days: Math.floor(distance / (1000 * 60 * 60 * 24)),
        hours: Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
        minutes: Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)),
        seconds: Math.floor((distance % (1000 * 60)) / 1000)
      };
    }

    updateCountdownDisplay(timeUnits) {
      this.elements.countdown.days.textContent = timeUnits.days;
      this.elements.countdown.hours.textContent = timeUnits.hours;
      this.elements.countdown.minutes.textContent = timeUnits.minutes;
      this.elements.countdown.seconds.textContent = timeUnits.seconds;
    }

    setCountdownToZero() {
      Object.values(this.elements.countdown).forEach(el => {
        if (el) el.textContent = "0";
      });
    }

    // =============================================================================
    // WISHES MODULE
    // =============================================================================

    initializeWishes() {
      this.loadWishes();
      setInterval(() => this.loadWishes(), this.config.wishes.refreshInterval);
    }

    setupWishesRefreshButton() {
      const button = document.querySelector('.refresh-btn');
      if (button) {
        button.addEventListener('click', () => this.loadWishes());
      }
    }

    async loadWishes() {
      this.showWishesLoading();
      
      try {
        const data = await this.loadWishesFromCSV();
        this.displayWishes(data);
      } catch (error) {
        console.error('Error loading wishes:', error);
        this.showWishesError(this.config.wishes.loadingMessages.error);
      }
      
      this.hideWishesLoading();
    }

    async loadWishesFromCSV() {
      const csvUrl = `https://docs.google.com/spreadsheets/d/${this.config.wishes.sheetId}/export?format=csv`;
      const response = await fetch(csvUrl);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const csvText = await response.text();
      return this.parseCSV(csvText);
    }

    parseCSV(csvText) {
      const lines = csvText.split('\n');
      const result = [];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line) {
          const cells = line.split(',').map(cell => 
            cell.replace(/^"|"$/g, '').trim()
          );
          result.push(cells);
        }
      }
      
      return result;
    }

    displayWishes(data) {
      if (!data || data.length <= 1) {
        this.showWishesError(this.config.wishes.loadingMessages.noWishes);
        return;
      }

      const validWishes = this.filterValidWishes(data);
      
      if (validWishes.length === 0) {
        this.showWishesError(this.config.wishes.loadingMessages.noValidWishes);
        return;
      }

      this.updateWishesStats(validWishes.length);
      this.renderWishCards(validWishes);
    }

    filterValidWishes(data) {
      return data.slice(1).filter(row => {
        const name = row[this.config.wishes.nameColumn] ? 
          row[this.config.wishes.nameColumn].toString().trim() : '';
        const wish = row[this.config.wishes.wishColumn] ? 
          row[this.config.wishes.wishColumn].toString().trim() : '';
        return name && wish;
      });
    }

    updateWishesStats(count) {
      this.elements.wishes.stats.innerHTML = 
        this.config.wishes.loadingMessages.statsTemplate.replace('{count}', count);
      this.elements.wishes.stats.style.display = 'block';
    }

    renderWishCards(validWishes) {
      this.elements.wishes.grid.innerHTML = validWishes.map(row => {
        const name = row[this.config.wishes.nameColumn].toString().trim();
        const wish = row[this.config.wishes.wishColumn].toString().trim();
        
        return `
          <div class="wish-card">
            <div class="wish-text">${this.escapeHtml(wish)}</div>
            <div class="wish-author">${this.escapeHtml(name)}</div>
          </div>
        `;
      }).join('');
    }

    showWishesLoading() {
      this.elements.wishes.loading.style.display = 'flex';
      this.elements.wishes.error.style.display = 'none';
      this.elements.wishes.stats.style.display = 'none';
      this.elements.wishes.grid.innerHTML = '';
    }

    hideWishesLoading() {
      this.elements.wishes.loading.style.display = 'none';
    }

    showWishesError(message) {
      this.elements.wishes.error.textContent = message;
      this.elements.wishes.error.style.display = 'block';
    }

    escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // =============================================================================
    // SCROLL TOGGLE MODULE
    // =============================================================================

    setupScrollToggle() {
      if (!this.elements.scrollToggleBtn) return;
      
      // Make toggleScroll globally accessible for HTML onclick handlers
      window.toggleScroll = () => this.toggleScroll();
      
      window.addEventListener('scroll', () => this.updateScrollButton());
    }

    toggleScroll() {
      const wishesRect = this.elements.wishesSection.getBoundingClientRect();
      const isAtWishes = wishesRect.top <= 100 && wishesRect.bottom >= 100;
      
      if (isAtWishes) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        this.elements.wishesSection.scrollIntoView({ behavior: 'smooth' });
      }
    }

    updateScrollButton() {
      if (!this.elements.scrollToggleBtn || !this.elements.wishesSection) return;
      
      const wishesRect = this.elements.wishesSection.getBoundingClientRect();
      const isAtWishes = wishesRect.top <= 100 && wishesRect.bottom >= 100;
      
      if (isAtWishes) {
        this.elements.scrollToggleBtn.classList.add('at-wishes');
        this.elements.scrollToggleBtn.title = this.config.ui.scrollButton.backToTop;
        this.elements.scrollToggleBtn.innerHTML = '<i class="fa fa-chevron-up"></i>';
      } else {
        this.elements.scrollToggleBtn.classList.remove('at-wishes');
        this.elements.scrollToggleBtn.title = this.config.ui.scrollButton.viewWishes;
        this.elements.scrollToggleBtn.innerHTML = '<i class="fa fa-chevron-down"></i>';
      }
    }

    // =============================================================================
    // BACK BUTTON MODULE
    // =============================================================================

    setupBackButton() {
      if (!this.elements.backBtn) return;
      
      this.elements.backBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (this.state.currentIndex > 0) {
          this.state.currentIndex--;
          this.updateVisibility();
        }
      });
    }

    // =============================================================================
    // PUBLIC METHODS FOR EXTERNAL ACCESS
    // =============================================================================

    // Method to update configuration after initialization
    updateConfig(newConfig) {
      this.config = { ...this.config, ...newConfig };
      this.updateLocationModalContent(); // Update modal content when config changes
    }

    // Method to manually trigger wishes reload
    reloadWishes() {
      this.loadWishes();
    }

    // Method to reset invitation state
    reset() {
      this.state.currentIndex = 0;
      this.state.slideIndex = 0;
      this.updateVisibility();
      this.showSlides();
    }

    // Cleanup method
    destroy() {
      if (this.state.slideTimer) clearTimeout(this.state.slideTimer);
      if (this.state.countdownTimer) clearInterval(this.state.countdownTimer);
    }
  }


// 3. RIPPLE FUNCTIONS (you already have these)

// =============================================================================
// RIPPLE EFFECT
// =============================================================================
function createRipple(e) {
  const overlay = document.getElementById('landingOverlay');
  const ripple = document.createElement('div');
  
  ripple.classList.add('ripple');
  
  const x = e.clientX;
  const y = e.clientY;
  const size = Math.max(window.innerWidth, window.innerHeight) * 2;
  
  ripple.style.width = size + 'px';
  ripple.style.height = size + 'px';
  ripple.style.left = (x - size / 2) + 'px';
  ripple.style.top = (y - size / 2) + 'px';
  
  overlay.appendChild(ripple);
  
  setTimeout(() => {
    ripple.remove();
  }, 8000);
}

function openInvitation(e) {
  const overlay = document.getElementById('landingOverlay');
  const mainContent = document.getElementById('mainContent');
  
  createRipple(e);
  
  // setTimeout(() => {
  //   overlay.classList.add('fade-out');
  // }, 400);
  
  // setTimeout(() => {
  //   overlay.style.display = 'none';
  //   mainContent.classList.add('show');
  //   sessionStorage.setItem('landingShown', 'true');
    
  //   // Initialize wedding invitation NOW
  //   if (typeof WeddingInvitation !== 'undefined') {
  //     window.weddingInvitation = new WeddingInvitation(WEDDING_CONFIG);
  //   }
  // }, 1200);
}

// Check if landing should be skipped
window.addEventListener('load', function() {
  const landingShown = sessionStorage.getItem('landingShown');
  const overlay = document.getElementById('landingOverlay');
  const mainContent = document.getElementById('mainContent');
  
  if (landingShown) {
    overlay.style.display = 'none';
    mainContent.classList.add('show');
    // Initialize immediately if already shown before
    if (typeof WeddingInvitation !== 'undefined') {
      window.weddingInvitation = new WeddingInvitation(WEDDING_CONFIG);
    }
  }
});
  </script>

  <!-- <script src="script.js" defer></script> -->
</body>
</html>