<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Free Code Space</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>
<body class="page">
 <main class="centered">
  <header>
    <h1>Free Code Space</h1>
    <a href="index.html" class="btn small">‚Üê Back to Main Page</a>
  </header>

  <!-- Language Selector -->
  <div class="button-group">
    <button id="pythonBtn" class="btn active">Python</button>
    <button id="javaBtn" class="btn">Java</button>
  </div>

  <!-- Code Editor -->
  <textarea id="code" class="editor">
# Python Example
for i in range(1, 6):
    print(f"Number {i}")
  </textarea>

  <!-- Run Button -->
  <button id="runBtn" class="btn run">Run Code</button>

  <!-- Output -->
  <pre id="output" class="output"></pre>

  <script>
  let pyodideReady = loadPyodide();
  let currentLang = "python";

  const pythonExample = `# Python Example
for i in range(1, 6):
    print(f"Number {i}")`;

  const javaExample = `// Java Example
public class Main {
    public static void main(String[] args) {
        for (int i = 1; i <= 5; i++) {
            System.out.println("Number " + i);
        }
    }
}`;

  // Language Switch
  document.getElementById("pythonBtn").addEventListener("click", () => {
    currentLang = "python";
    toggleActive("pythonBtn", "javaBtn");
    document.getElementById("code").value = pythonExample;
  });

  document.getElementById("javaBtn").addEventListener("click", () => {
    currentLang = "java";
    toggleActive("javaBtn", "pythonBtn");
    document.getElementById("code").value = javaExample;
  });

  function toggleActive(activeId, inactiveId) {
    document.getElementById(activeId).classList.add("active");
    document.getElementById(inactiveId).classList.remove("active");
  }

  // Run Button
  document.getElementById("runBtn").addEventListener("click", async () => {
    const outputEl = document.getElementById("output");
    outputEl.textContent = "Running...";

    if (currentLang === "python") {
      const pyodide = await pyodideReady;
      try {
        pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = sys.stderr = StringIO()
        `);
        await pyodide.runPythonAsync(document.getElementById("code").value);
        const result = pyodide.runPython("sys.stdout.getvalue()");
        outputEl.textContent = result || "(No output)";
      } catch (err) {
        outputEl.textContent = "Error:\n" + err;
      }
    } else if (currentLang === "java") {
      const code = document.getElementById("code").value;
      const response = await fetch("https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-RapidAPI-Key": "63e8ded8d1mshc9dec62dc111d79p16340ajsn531a2aec33dc",
          "X-RapidAPI-Host": "judge0-ce.p.rapidapi.com"
        },
        body: JSON.stringify({
          language_id: 62,
          source_code: code
        })
      });
      const data = await response.json();
      if (data.stdout) outputEl.textContent = data.stdout;
      else if (data.stderr) outputEl.textContent = "Error:\n" + data.stderr;
      else outputEl.textContent = "(No output)";
    }
  });
  </script>
  </main>
</body>
</html>
